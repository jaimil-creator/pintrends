{% if expanded_keywords %}
<div class="flex justify-between items-center mb-6">
    <h5 class="text-xl font-bold">Generated {{ expanded_keywords|length }} Phrases</h5>
</div>

{% regroup expanded_keywords by base_keyword as keyword_groups %}

<div class="space-y-12">
    {% for group in keyword_groups %}
    <div class="keyword-group">
        <div class="flex items-center gap-3 mb-6 border-b border-gray-100 pb-4">
            <span
                class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 text-gray-500 font-bold text-lg">
                {{ forloop.counter }}
            </span>
            <div>
                <h5 class="text-xl font-bold text-gray-900">{{ group.grouper }}</h5>
                <p class="text-sm text-gray-500">{{ group.list|length }} search phrases extracted</p>
            </div>
            <div class="ml-auto">
                <form hx-post="{% url 'wizard:add_custom_keyword_htmx' project.id %}"
                    hx-target="#grid-{{ forloop.counter }}" hx-swap="afterbegin" class="flex items-center gap-2">
                    {% csrf_token %}
                    <input type="hidden" name="base_keyword" value="{{ group.grouper }}">
                    <input type="text" name="keyword" placeholder="Add custom phrase..."
                        class="bg-white border border-gray-200 rounded-full px-4 py-1.5 text-sm outline-none focus:ring-2 focus:ring-pinterest-red focus:border-transparent transition-all w-48 focus:w-64">
                    <button type="submit"
                        class="bg-gray-900 hover:bg-black text-white p-2 rounded-full transition-colors flex items-center justify-center">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </form>
            </div>
        </div>

        <div class="flex flex-col gap-3 w-full" id="grid-{{ forloop.counter }}">
            {% for kw in group.list %}
            {% include 'wizard/partials/keyword_card.html' with kw=kw project=project %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<div class="text-center py-16">
    <div
        class="inline-flex items-center justify-center w-24 h-24 bg-green-50 rounded-full mb-6 text-green-600 text-5xl shadow-sm">
        <i class="bi bi-stars"></i>
    </div>
    <h4 class="text-2xl font-bold text-gray-900 mb-2">Let AI do the work</h4>
    <p class="text-gray-500 mb-8 max-w-md mx-auto">Click "Expand with AI" to generate high-potential search phrases.</p>

    <button
        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform active:scale-95 flex items-center gap-2 mx-auto"
        hx-get="{% url 'wizard:expand_keywords_htmx' project.id %}" hx-target="#expansion-container" hx-swap="innerHTML"
        hx-indicator="#loading-spinner">
        <i class="bi bi-stars"></i> Expand with AI
    </button>
</div>
{% endif %}